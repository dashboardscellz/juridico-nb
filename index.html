<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NB Advocacia - Gestão Jurídica v7.0</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <style>
    body { font-family: system-ui, -apple-system, sans-serif; background-color: #f8fafc; }
    .fade-in { animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    
    .bg-navy { background-color: #0f172a; }
    
    /* Scrollbar */
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // --- CONFIGURAÇÃO FIREBASE ---
    const firebaseConfig = {
      apiKey: "AIzaSyAP_VVV_tpGBpDMj77UFM3Z9QnqkdQafNY",
      authDomain: "juridico-nb.firebaseapp.com",
      projectId: "juridico-nb",
      storageBucket: "juridico-nb.firebasestorage.app",
      messagingSenderId: "1039744856084",
      appId: "1:1039744856084:web:75c32201c88da75c413701",
      measurementId: "G-TYQB8QGNG1"
    };

    if (!firebase.apps.length) { try { firebase.initializeApp(firebaseConfig); } catch (e) { console.error("Erro Firebase:", e); } }
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    const COL_PROCESSOS = 'gestao_processos_nb';
    const COL_USUARIOS = 'credenciais_advocacia';
    const COL_PROFISSIONAIS = 'equipe_nomes_nb'; // Nova coleção para lista de estagiários/advogados

    // --- LISTAS E CONSTANTES ---
    const LISTA_RAMOS = [
        "Cível", "Previdenciário", "Trabalhista", "Penal", "Família e Sucessões", 
        "Consumidor", "Administrativo", "Tributário", "Empresarial", "Eleitoral", 
        "Ambiental", "Digital", "Imobiliário", "Militar", "Agrário", "Internacional", 
        "Marítimo", "Aeronáutico", "Desportivo", "Propriedade Intelectual", "Outros"
    ];

    const LISTA_ESTADOS = [
        "AC", "AL", "AP", "AM", "BA", "CE", "DF", "ES", "GO", "MA", "MT", "MS", "MG", 
        "PA", "PB", "PR", "PE", "PI", "RJ", "RN", "RS", "RO", "RR", "SC", "SP", "SE", "TO"
    ];

    const LISTA_EQUIPE_PADRAO = [
        "Evison Nascimento", "Adiellyson Bomfim", 
        "Manassés Oliveira (Estagiário)", "Bárbara Brenda (Estagiária)"
    ];

    // --- ÍCONES ---
    const Icons = {
      Scale: () => <svg className="w-8 h-8" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>,
      WhatsApp: () => <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-8.68-2.031-.967-.272-.099-.47-.149-.669.198-.199.347-.768.967-.941 1.165-.173.199-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>,
      Plus: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"></path></svg>,
      Search: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>,
      X: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"></path></svg>,
      Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>,
      Edit: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>,
      Calculator: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>,
      Excel: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
      Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"></path></svg>,
      Users: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
      Key: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>,
      Filter: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>
    };

    const formatCPF = (v) => v.replace(/\D/g, '').replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
    const formatPhone = (v) => v.replace(/\D/g, '').replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
    const openWhatsApp = (phone) => {
        const clean = phone.replace(/\D/g, '');
        if (clean) window.open(`https://wa.me/55${clean}`, '_blank');
        else alert("Número inválido.");
    };

    // --- CALCULADORA ---
    const CalculatorModal = ({ onClose }) => {
        const [dataInicial, setDataInicial] = useState("");
        const [dias, setDias] = useState("");
        const [tipo, setTipo] = useState("uteis");
        const [resultado, setResultado] = useState(null);

        const calcular = () => {
            if (!dataInicial || !dias) return;
            const dt = new Date(dataInicial);
            dt.setMinutes(dt.getMinutes() + dt.getTimezoneOffset());
            let count = 0;
            const target = parseInt(dias);
            while (count < target) {
                dt.setDate(dt.getDate() + 1);
                if (tipo === 'uteis') {
                    const day = dt.getDay();
                    if (day !== 0 && day !== 6) count++;
                } else {
                    count++;
                }
            }
            setResultado(dt.toLocaleDateString('pt-BR'));
        };

        return (
            <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 fade-in">
                <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
                    <div className="bg-navy p-4 flex justify-between items-center text-white">
                        <h3 className="font-bold flex gap-2 items-center text-lg"><Icons.Calculator/> Calculadora de Prazo</h3>
                        <button onClick={onClose}><Icons.X/></button>
                    </div>
                    <div className="p-6 space-y-4">
                        <div className="text-center text-sm text-slate-500 mb-4 font-semibold uppercase tracking-wide">Simulador de Prazos</div>
                        <div className="pt-2 border-t">
                             <label className="text-xs font-bold text-slate-700 uppercase block mb-1">Data da Publicação</label>
                             <input type="date" className="w-full p-3 border rounded text-lg text-center font-bold text-navy" value={dataInicial} onChange={e=>setDataInicial(e.target.value)}/>
                        </div>
                        <div>
                             <label className="text-xs font-bold text-slate-700 uppercase block mb-1">Prazo em Dias</label>
                             <input type="number" className="w-full p-3 border rounded text-lg text-center font-bold text-navy" placeholder="0" value={dias} onChange={e=>setDias(e.target.value)}/>
                        </div>
                        <div className="flex justify-center gap-6 py-2">
                             <label className="flex items-center gap-2 cursor-pointer"><input type="radio" name="tipo" checked={tipo==='uteis'} onChange={()=>setTipo('uteis')} /> <span className="font-bold text-slate-700">Úteis</span></label>
                             <label className="flex items-center gap-2 cursor-pointer"><input type="radio" name="tipo" checked={tipo==='corridos'} onChange={()=>setTipo('corridos')} /> <span className="font-bold text-slate-700">Corridos</span></label>
                        </div>
                        <button onClick={calcular} className="w-full bg-orange-600 text-white font-bold py-3 rounded hover:bg-orange-700 shadow-lg transition">CALCULAR PRAZO FINAL</button>
                        {resultado && (
                            <div className="bg-green-50 p-4 rounded-lg text-center border border-green-200 mt-4">
                                <p className="text-xs text-green-700 font-bold uppercase">Data Final do Prazo</p>
                                <p className="text-3xl font-bold text-green-800">{resultado}</p>
                            </div>
                        )}
                    </div>
                </div>
            </div>
        );
    };

    // --- LOGIN ---
    const LoginScreen = ({ onLogin }) => {
      const [user, setUser] = useState("");
      const [pass, setPass] = useState("");
      const [error, setError] = useState("");

      const handle = async (e) => {
        e.preventDefault();
        if (user === "NB ADVOCACIA" && pass === "NB07242530") { onLogin(user, "master"); return; }
        
        try {
            const doc = await db.collection(COL_USUARIOS).doc(user).get();
            if (doc.exists && doc.data().senha === pass) {
                onLogin(user, doc.data().role || 'viewer');
            } else {
                setError("Dados incorretos.");
            }
        } catch(e) { setError("Erro de conexão."); }
      };

      return (
        <div className="min-h-screen bg-navy flex items-center justify-center p-4">
          <div className="w-full max-w-md bg-white rounded-xl shadow-2xl p-8 fade-in">
            <div className="text-center mb-6">
              <div className="text-yellow-600 flex justify-center mb-2"><Icons.Scale /></div>
              <h2 className="text-2xl font-bold text-slate-800">NB ADVOCACIA</h2>
              <p className="text-xs text-slate-500 uppercase tracking-widest">Acesso Restrito</p>
            </div>
            <form onSubmit={handle} className="space-y-4">
              <input className="w-full p-3 border rounded outline-none focus:border-yellow-600 focus:ring-1 focus:ring-yellow-600" placeholder="Usuário" value={user} onChange={e => setUser(e.target.value)} />
              <input type="password" className="w-full p-3 border rounded outline-none focus:border-yellow-600 focus:ring-1 focus:ring-yellow-600" placeholder="Senha" value={pass} onChange={e => setPass(e.target.value)} />
              {error && <p className="text-red-500 text-sm text-center">{error}</p>}
              <button className="w-full bg-navy text-white py-3 rounded font-bold hover:bg-slate-800 transition">ENTRAR</button>
            </form>
          </div>
        </div>
      );
    };

    // --- APP PRINCIPAL ---
    const AppContent = () => {
      const [authOk, setAuthOk] = useState(false);
      const [user, setUser] = useState("");
      const [role, setRole] = useState("viewer");
      const [processos, setProcessos] = useState([]);
      const [busca, setBusca] = useState("");
      const [filtroResponsavel, setFiltroResponsavel] = useState("Todos");
      const [aba, setAba] = useState('processos');

      // Modais
      const [modal, setModal] = useState(false);
      const [calcModal, setCalcModal] = useState(false);
      const [editingId, setEditingId] = useState(null);
      
      // Gestão Master
      const [modalSenha, setModalSenha] = useState(false);
      const [novaSenha, setNovaSenha] = useState("");
      const [listaUsuarios, setListaUsuarios] = useState([]);
      const [novoUsuario, setNovoUsuario] = useState({ nome: "", senha: "", role: "viewer" });
      
      // Lista Dinâmica de Profissionais
      const [listaEquipe, setListaEquipe] = useState(LISTA_EQUIPE_PADRAO);
      const [novoMembro, setNovoMembro] = useState("");

      const initialForm = {
        cliente: "", cpf: "", telefone: "", descricao: "", estado: "PE", cidade: "",
        numeroProcesso: "", semProcesso: false, ramo: "Cível", advogado: "Evison Nascimento",
        prazo: "", statusProcessual: "Em Andamento",
        patologia: "", govLogin: "", govSenha: "", 
        dataEntrada: "", statusBeneficio: "Em Análise", 
        dataPericia: "", dataSocial: "",
        procuracaoEntregue: false, linkProcuracao: "",
        contratoEntregue: false, linkContrato: "",
        tipoPagamento: "Valor Cheio", qtdParcelas: 1, valorParcela: "", 
        valorContrato: "", dataPagamento: "", statusPagamento: "Pendente"
      };
      const [formData, setFormData] = useState(initialForm);

      const handleLogin = (u, r) => { setUser(u); setRole(r); setAuthOk(true); };

      useEffect(() => {
        if (!authOk) return;
        auth.signInAnonymously();
        
        // Carrega Processos
        const unsubProc = db.collection(COL_PROCESSOS).onSnapshot(snap => {
            setProcessos(snap.docs.map(d => ({id: d.id, ...d.data()})));
        });

        // Carrega Lista de Equipe (Nomes Dropdown)
        const unsubEquipe = db.collection(COL_PROFISSIONAIS).doc('lista_atual').onSnapshot(doc => {
            if (doc.exists && doc.data().nomes) setListaEquipe(doc.data().nomes);
            else db.collection(COL_PROFISSIONAIS).doc('lista_atual').set({ nomes: LISTA_EQUIPE_PADRAO });
        });

        return () => { unsubProc(); unsubEquipe(); };
      }, [authOk]);

      // Carregar Usuários (Só Master na aba Equipe)
      useEffect(() => {
        if (aba === 'equipe' && role === 'master') {
            db.collection(COL_USUARIOS).get().then(snap => {
                setListaUsuarios(snap.docs.map(d => ({id: d.id, ...d.data()})));
            });
        }
      }, [aba, role]);

      // --- MASTER FUNCTIONS ---
      const adicionarMembroEquipe = async () => {
          if (!novoMembro) return;
          const novaLista = [...listaEquipe, novoMembro];
          await db.collection(COL_PROFISSIONAIS).doc('lista_atual').set({ nomes: novaLista });
          setNovoMembro("");
          alert("Profissional adicionado à lista!");
      };

      const removerMembroEquipe = async (nome) => {
          if(!confirm("Remover este nome da lista?")) return;
          const novaLista = listaEquipe.filter(n => n !== nome);
          await db.collection(COL_PROFISSIONAIS).doc('lista_atual').set({ nomes: novaLista });
      };

      const alterarSenha = async () => {
        if (!novaSenha || novaSenha.length < 4) return alert("Senha curta.");
        await db.collection(COL_USUARIOS).doc(user).set({ senha: novaSenha }, { merge: true });
        alert("Senha alterada!"); setModalSenha(false); setNovaSenha("");
      };

      const salvarUsuario = async () => {
         if (!novoUsuario.nome || !novoUsuario.senha) return alert("Preencha tudo.");
         await db.collection(COL_USUARIOS).doc(novoUsuario.nome).set({ senha: novoUsuario.senha, role: novoUsuario.role });
         alert("Usuário salvo!"); setNovoUsuario({nome: "", senha: "", role: "viewer"});
         const snap = await db.collection(COL_USUARIOS).get();
         setListaUsuarios(snap.docs.map(d => ({id: d.id, ...d.data()})));
      };

      const excluirUsuario = async (id) => {
          if (!confirm("Remover usuário?")) return;
          await db.collection(COL_USUARIOS).doc(id).delete();
          const snap = await db.collection(COL_USUARIOS).get();
          setListaUsuarios(snap.docs.map(d => ({id: d.id, ...d.data()})));
      };

      // --- CRUD PROCESSOS ---
      const salvar = async () => {
        if (!formData.cliente) return alert("Nome do cliente obrigatório.");
        try {
            if (editingId) await db.collection(COL_PROCESSOS).doc(editingId).update(formData);
            else await db.collection(COL_PROCESSOS).add({...formData, criadoEm: new Date().toISOString()});
            setModal(false); setEditingId(null); setFormData(initialForm);
        } catch (e) { alert("Erro ao salvar."); }
      };

      const apagar = async (id) => { if(confirm("Excluir?")) await db.collection(COL_PROCESSOS).doc(id).delete(); };
      
      const exportar = () => {
          const ws = XLSX.utils.json_to_sheet(processos);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Processos");
          XLSX.writeFile(wb, "Processos_NB.xlsx");
      };

      // FILTRAGEM
      const processosFiltrados = processos.filter(p => {
          const matchBusca = p.cliente.toLowerCase().includes(busca.toLowerCase()) || (p.cpf && p.cpf.includes(busca));
          const matchResp = filtroResponsavel === "Todos" || p.advogado === filtroResponsavel;
          return matchBusca && matchResp;
      });

      if (!authOk) return <LoginScreen onLogin={handleLogin} />;

      return (
        <div className="min-h-screen pb-20 fade-in">
          <header className="bg-white border-b sticky top-0 z-30 px-6 py-4 shadow-sm flex justify-between items-center no-print">
             <div className="flex items-center gap-3">
                 <div className="text-yellow-600"><Icons.Scale /></div>
                 <div>
                     <h1 className="text-xl font-bold text-slate-900 font-serif leading-none">NB ADVOCACIA</h1>
                     <span className="text-xs font-bold text-slate-400 tracking-widest uppercase">{role === 'master' ? 'Painel Mestre' : `Dr(a). ${user}`}</span>
                 </div>
             </div>
             <div className="flex gap-2 items-center">
                 <button onClick={()=>setCalcModal(true)} className="px-3 py-2 rounded text-sm font-bold text-slate-600 bg-slate-100 hover:bg-slate-200 flex items-center gap-2 border border-slate-200">
                    <Icons.Calculator/> <span className="hidden md:inline">Calc. Prazo</span>
                 </button>
                 
                 {role === 'master' ? (
                     <button onClick={()=>setAba('equipe')} className={`px-3 py-2 rounded text-sm font-bold flex gap-2 items-center border ${aba==='equipe'?'bg-navy text-white':'text-slate-600 bg-slate-100 hover:bg-slate-200'}`}>
                        <Icons.Users/> Equipe
                     </button>
                 ) : (
                     <button onClick={()=>setModalSenha(true)} className="px-3 py-2 rounded text-sm font-bold text-slate-600 bg-slate-100 hover:bg-slate-200 flex items-center gap-2 border border-slate-200"><Icons.Key/> Senha</button>
                 )}
                 
                 <button onClick={()=>setAba('processos')} className={`px-3 py-2 rounded text-sm font-bold flex gap-2 items-center border ${aba==='processos'?'bg-navy text-white':'text-slate-600 bg-slate-100 hover:bg-slate-200'}`}>Processos</button>

                 {(role !== 'viewer' && aba === 'processos') && (
                     <button onClick={()=>{setFormData(initialForm); setEditingId(null); setModal(true);}} 
                             className="bg-yellow-600 text-white px-4 py-2 rounded text-sm font-bold hover:bg-yellow-700 flex gap-2 items-center shadow transition-colors">
                        <Icons.Plus/> NOVO
                     </button>
                 )}
             </div>
          </header>

          <main className="max-w-7xl mx-auto px-6 py-8">
             {calcModal && <CalculatorModal onClose={()=>setCalcModal(false)} />}

             {/* ABA EQUIPE (SÓ MESTRE) */}
             {aba === 'equipe' && role === 'master' && (
                 <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 fade-in">
                    {/* COLUNA 1: LOGINS */}
                    <div className="bg-white rounded-xl shadow-sm p-6">
                        <h3 className="font-bold text-slate-700 mb-4 flex gap-2"><Icons.Key/> Acesso ao Sistema</h3>
                        <div className="bg-slate-50 p-4 rounded border mb-4">
                            <h4 className="text-xs font-bold text-slate-500 uppercase mb-2">Novo Login</h4>
                            <div className="space-y-2">
                                <input className="w-full p-2 border rounded" placeholder="Nome (Login)" value={novoUsuario.nome} onChange={e=>setNovoUsuario({...novoUsuario, nome: e.target.value})}/>
                                <div className="flex gap-2">
                                    <input className="flex-1 p-2 border rounded" placeholder="Senha" value={novoUsuario.senha} onChange={e=>setNovoUsuario({...novoUsuario, senha: e.target.value})}/>
                                    <select className="p-2 border rounded bg-white" value={novoUsuario.role} onChange={e=>setNovoUsuario({...novoUsuario, role: e.target.value})}>
                                        <option value="viewer">Visualizador</option><option value="admin">Admin</option>
                                    </select>
                                    <button onClick={salvarUsuario} className="bg-navy text-white px-4 rounded font-bold">Salvar</button>
                                </div>
                            </div>
                        </div>
                        <table className="w-full text-sm text-left">
                            <thead className="bg-slate-100 border-b"><tr><th className="p-2">Usuário</th><th className="p-2">Senha</th><th className="p-2">Role</th><th className="p-2"></th></tr></thead>
                            <tbody>
                                {listaUsuarios.map(u => (
                                    <tr key={u.id} className="border-b"><td className="p-2 font-bold">{u.id}</td><td className="p-2 font-mono text-slate-500">{u.senha}</td><td className="p-2 uppercase text-xs">{u.role}</td><td className="p-2"><button onClick={()=>excluirUsuario(u.id)} className="text-red-500"><Icons.Trash/></button></td></tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* COLUNA 2: DROPDOWN NOMES */}
                    <div className="bg-white rounded-xl shadow-sm p-6">
                        <h3 className="font-bold text-slate-700 mb-4 flex gap-2"><Icons.Users/> Corpo Jurídico (Dropdown)</h3>
                        <p className="text-xs text-slate-500 mb-4">Adicione aqui os nomes que aparecerão na lista de "Advogado Responsável" (inclusive estagiários).</p>
                        <div className="flex gap-2 mb-4">
                            <input className="flex-1 p-2 border rounded" placeholder="Nome Completo (ex: Fulano Estagiário)" value={novoMembro} onChange={e=>setNovoMembro(e.target.value)}/>
                            <button onClick={adicionarMembroEquipe} className="bg-green-600 text-white px-4 rounded font-bold">Adicionar</button>
                        </div>
                        <ul className="divide-y border rounded">
                            {listaEquipe.map((nome, i) => (
                                <li key={i} className="p-3 flex justify-between items-center bg-slate-50">
                                    <span className="font-bold text-slate-700">{nome}</span>
                                    <button onClick={()=>removerMembroEquipe(nome)} className="text-red-400 hover:text-red-600"><Icons.Trash/></button>
                                </li>
                            ))}
                        </ul>
                    </div>
                 </div>
             )}

             {/* ABA PROCESSOS */}
             {aba === 'processos' && (
                 <div className="bg-white rounded-xl shadow-sm overflow-hidden fade-in">
                     <div className="p-4 border-b bg-slate-50 flex flex-col md:flex-row gap-4 justify-between items-center">
                         <div className="relative flex-1 w-full">
                            <span className="absolute left-3 top-2.5 text-slate-400"><Icons.Search/></span>
                            <input type="text" placeholder="Buscar cliente..." className="pl-9 pr-4 py-2 border rounded-lg text-sm w-full focus:outline-none focus:border-navy focus:ring-1 focus:ring-navy" value={busca} onChange={e => setBusca(e.target.value)} />
                         </div>
                         
                         {/* FILTRO RESPONSÁVEL */}
                         <div className="flex items-center gap-2 w-full md:w-auto">
                             <div className="relative w-full md:w-60">
                                 <span className="absolute left-3 top-2.5 text-slate-400"><Icons.Filter/></span>
                                 <select className="pl-9 pr-4 py-2 border rounded-lg text-sm w-full bg-white font-bold text-slate-600 outline-none focus:border-navy" value={filtroResponsavel} onChange={e=>setFiltroResponsavel(e.target.value)}>
                                     <option value="Todos">Todos os Responsáveis</option>
                                     {listaEquipe.map(nome => <option key={nome} value={nome}>Apenas {nome.split(' ')[0]}</option>)}
                                 </select>
                             </div>
                             <button onClick={exportar} className="flex items-center gap-1 text-xs font-bold bg-green-50 text-green-700 border border-green-200 px-3 py-2 rounded hover:bg-green-100"><Icons.Excel/> Excel</button>
                         </div>
                     </div>
                     <div className="overflow-x-auto">
                         <table className="w-full text-sm text-left whitespace-nowrap">
                             <thead className="bg-slate-100 text-slate-500 font-bold border-b">
                                 <tr><th>Status</th><th>Cliente / Local</th><th>Processo/Ramo</th><th>Resp.</th><th>Prazo</th><th>Financeiro</th><th className="text-center">Ações</th></tr>
                             </thead>
                             <tbody className="divide-y">
                                 {processosFiltrados.map(p => (
                                     <tr key={p.id} className="hover:bg-slate-50">
                                         <td className="px-4 py-3"><span className={`px-2 py-1 rounded text-[10px] font-bold uppercase ${p.statusProcessual==='Concluso'?'bg-green-100 text-green-700':'bg-blue-50 text-blue-700'}`}>{p.statusProcessual}</span></td>
                                         <td className="px-4 py-3">
                                             <div className="font-bold text-slate-700 flex items-center gap-2">{p.cliente} {p.telefone && <button onClick={()=>openWhatsApp(p.telefone)} className="text-green-500"><Icons.WhatsApp/></button>}</div>
                                             <div className="text-xs text-slate-400">{p.cidade} - {p.estado}</div>
                                         </td>
                                         <td className="px-4 py-3">
                                             <div className="text-slate-700 font-mono text-xs">{p.semProcesso ? 'PRÉ-PROCESSUAL' : (p.numeroProcesso || 'S/N')}</div>
                                             <div className="text-xs text-slate-400">{p.ramo}</div>
                                         </td>
                                         <td className="px-4 py-3 text-slate-600 font-medium">{p.advogado}</td>
                                         <td className="px-4 py-3 text-red-600 font-bold">{p.prazo ? new Date(p.prazo).toLocaleDateString() : '-'}</td>
                                         <td className="px-4 py-3"><div className="text-xs">{p.valorContrato || '0,00'}</div><span className={`text-[10px] font-bold uppercase ${p.statusPagamento==='Pago'?'text-green-600':'text-orange-500'}`}>{p.statusPagamento}</span></td>
                                         <td className="px-4 py-3 text-center flex justify-center gap-2">
                                             <button onClick={()=>{setFormData(p); setEditingId(p.id); setModal(true);}} className="text-blue-400 hover:text-navy"><Icons.Edit/></button>
                                             {role !== 'viewer' && <button onClick={()=>apagar(p.id)} className="text-slate-300 hover:text-red-500"><Icons.Trash/></button>}
                                         </td>
                                     </tr>
                                 ))}
                             </tbody>
                         </table>
                     </div>
                 </div>
             )}
          </main>

          {/* MODAL ALTERAR SENHA (USUÁRIO COMUM) */}
          {modalSenha && (
            <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 fade-in">
                <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
                    <h3 className="font-bold text-lg text-slate-800 mb-4 flex gap-2 items-center"><Icons.Key/> Alterar Minha Senha</h3>
                    <input type="password" placeholder="Nova Senha" className="w-full p-2 border rounded mb-4" value={novaSenha} onChange={e=>setNovaSenha(e.target.value)}/>
                    <div className="flex gap-2">
                        <button onClick={()=>setModalSenha(false)} className="flex-1 py-2 border rounded hover:bg-slate-50">Cancelar</button>
                        <button onClick={alterarSenha} className="flex-1 py-2 bg-navy text-white rounded font-bold hover:bg-slate-800">Salvar</button>
                    </div>
                </div>
            </div>
          )}

          {/* MODAL FORMULÁRIO */}
          {modal && (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 fade-in">
                <div className="bg-white w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                    <div className="bg-navy px-6 py-4 flex justify-between items-center shrink-0">
                        <div className="flex items-center gap-2 text-yellow-500"><Icons.Scale /><h3 className="text-lg font-bold text-white tracking-wide">{editingId ? 'EDITAR' : 'NOVO CADASTRO'}</h3></div>
                        <button onClick={()=>setModal(false)} className="text-slate-400 hover:text-white"><Icons.X /></button>
                    </div>
                    
                    <div className="p-6 overflow-y-auto custom-scrollbar space-y-5">
                        <div className="space-y-3">
                            <div><label className="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Cliente</label><input className="w-full p-2 border rounded bg-slate-50 font-bold text-slate-700 outline-none focus:border-yellow-600" value={formData.cliente} onChange={e=>setFormData({...formData, cliente: e.target.value})}/></div>
                            <div className="grid grid-cols-2 gap-3">
                                <div><label className="text-[10px] font-bold text-slate-400 uppercase mb-1 block">CPF</label><input className="w-full p-2 border rounded outline-none focus:border-yellow-600" value={formData.cpf} onChange={e=>setFormData({...formData, cpf: formatCPF(e.target.value)})}/></div>
                                <div><label className="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Telefone</label><input className="w-full p-2 border rounded outline-none focus:border-yellow-600" value={formData.telefone} onChange={e=>setFormData({...formData, telefone: formatPhone(e.target.value)})}/></div>
                            </div>
                            
                            {/* ESTADOS E CIDADES */}
                            <div className="grid grid-cols-3 gap-3">
                                <div><label className="text-[10px] font-bold text-slate-400 uppercase mb-1 block">UF</label>
                                    <select className="w-full p-2 border rounded bg-white" value={formData.estado} onChange={e=>setFormData({...formData, estado: e.target.value})}>
                                        {LISTA_ESTADOS.map(uf => <option key={uf}>{uf}</option>)}
                                    </select>
                                </div>
                                <div className="col-span-2"><label className="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Cidade</label><input className="w-full p-2 border rounded" placeholder="Nome da cidade" value={formData.cidade} onChange={e=>setFormData({...formData, cidade: e.target.value})}/></div>
                            </div>

                            <div><label className="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Descrição do Caso</label><textarea className="w-full p-2 border rounded text-sm h-20 resize-none outline-none focus:border-yellow-600" value={formData.descricao} onChange={e=>setFormData({...formData, descricao: e.target.value})}></textarea></div>
                        </div>

                        <hr className="border-slate-100"/>

                        <div className="space-y-3">
                            <div className="flex items-center gap-4 mb-2">
                                <label className="text-[10px] font-bold text-navy uppercase tracking-wider block">Ramo:</label>
                                <select className="p-1 border rounded text-sm font-bold text-navy" value={formData.ramo} onChange={e=>setFormData({...formData, ramo: e.target.value})}>
                                    {LISTA_RAMOS.map(r => <option key={r}>{r}</option>)}
                                </select>
                            </div>

                            {/* PREVIDENCIÁRIO */}
                            {formData.ramo === 'Previdenciário' ? (
                                <div className="bg-blue-50/50 p-4 rounded-xl border border-blue-100 space-y-3">
                                    <h4 className="text-xs font-bold text-blue-800 uppercase flex items-center gap-2"><Icons.Users/> Previdenciário</h4>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="col-span-2"><label className="text-[10px] font-bold text-slate-500 uppercase">Patologia / Benefício</label><input className="w-full p-2 border rounded text-sm" value={formData.patologia} onChange={e=>setFormData({...formData, patologia: e.target.value})}/></div>
                                        <div><label className="text-[10px] font-bold text-slate-500 uppercase">Login GOV</label><input className="w-full p-2 border rounded text-sm font-mono bg-white" value={formData.govLogin} onChange={e=>setFormData({...formData, govLogin: e.target.value})}/></div>
                                        <div><label className="text-[10px] font-bold text-slate-500 uppercase">Senha GOV</label><input className="w-full p-2 border rounded text-sm font-mono bg-white" value={formData.govSenha} onChange={e=>setFormData({...formData, govSenha: e.target.value})}/></div>
                                        <div><label className="text-[10px] font-bold text-slate-500 uppercase">Perícia Médica</label><input type="datetime-local" className="w-full p-2 border rounded text-sm" value={formData.dataPericia} onChange={e=>setFormData({...formData, dataPericia: e.target.value})}/></div>
                                        <div><label className="text-[10px] font-bold text-slate-500 uppercase">Avaliação Social</label><input type="datetime-local" className="w-full p-2 border rounded text-sm" value={formData.dataSocial} onChange={e=>setFormData({...formData, dataSocial: e.target.value})}/></div>
                                    </div>
                                </div>
                            ) : (
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="col-span-2 flex items-center gap-2">
                                        <input type="checkbox" checked={formData.semProcesso} onChange={e=>setFormData({...formData, semProcesso: e.target.checked})}/> <span className="text-xs text-slate-500">Ainda não possui nº de processo</span>
                                    </div>
                                    {!formData.semProcesso && <div className="col-span-2"><label className="text-[10px] font-bold text-slate-400 uppercase">Nº Processo</label><input className="w-full p-2 border rounded font-mono" value={formData.numeroProcesso} onChange={e=>setFormData({...formData, numeroProcesso: e.target.value})}/></div>}
                                </div>
                            )}
                            
                            <div className="grid grid-cols-2 gap-3">
                                <div><label className="text-[10px] font-bold text-slate-400 uppercase">Responsável</label>
                                    <select className="w-full p-2 border rounded text-sm" value={formData.advogado} onChange={e=>setFormData({...formData, advogado: e.target.value})}>
                                        {listaEquipe.map(nome => <option key={nome}>{nome}</option>)}
                                    </select>
                                </div>
                                <div><label className="text-[10px] font-bold text-red-400 uppercase">Prazo Fatal</label><input type="date" className="w-full p-2 border rounded text-sm" value={formData.prazo} onChange={e=>setFormData({...formData, prazo: e.target.value})}/></div>
                                <div className="col-span-2"><label className="text-[10px] font-bold text-slate-400 uppercase">Status</label><select className="w-full p-2 border rounded text-sm" value={formData.statusProcessual} onChange={e=>setFormData({...formData, statusProcessual: e.target.value})}><option>Em Andamento</option><option>Concluso</option><option>Arquivado</option></select></div>
                            </div>
                        </div>

                        {/* ANEXOS (LINKS) */}
                        <div className="bg-slate-50 p-3 rounded-xl border border-slate-200">
                             <div className="flex items-center gap-2 mb-2"><span className="text-xs font-bold text-slate-600 uppercase">Anexos (Links Nuvem)</span></div>
                             <div className="space-y-2">
                                <div>
                                    <div className="flex items-center gap-2 mb-1"><input type="checkbox" checked={formData.procuracaoEntregue} onChange={e=>setFormData({...formData, procuracaoEntregue: e.target.checked})}/><span className="text-xs font-bold text-slate-500">Procuração</span></div>
                                    <input className="w-full p-2 border rounded text-xs bg-white text-blue-600 underline" placeholder="Cole o link..." value={formData.linkProcuracao} onChange={e=>setFormData({...formData, linkProcuracao: e.target.value})}/>
                                </div>
                                <div>
                                    <div className="flex items-center gap-2 mb-1"><input type="checkbox" checked={formData.contratoEntregue} onChange={e=>setFormData({...formData, contratoEntregue: e.target.checked})}/><span className="text-xs font-bold text-slate-500">Contrato</span></div>
                                    <input className="w-full p-2 border rounded text-xs bg-white text-blue-600 underline" placeholder="Cole o link..." value={formData.linkContrato} onChange={e=>setFormData({...formData, linkContrato: e.target.value})}/>
                                </div>
                             </div>
                        </div>

                        {/* FINANCEIRO */}
                        <div className="bg-orange-50/50 p-3 rounded-xl border border-orange-100">
                             <h4 className="text-xs font-bold text-orange-800 uppercase mb-2">Honorários</h4>
                             <div className="grid grid-cols-2 gap-3 mb-2">
                                 <div><label className="text-[10px] font-bold text-slate-400">Tipo</label><select className="w-full p-2 border rounded text-sm" value={formData.tipoPagamento} onChange={e=>setFormData({...formData, tipoPagamento: e.target.value})}><option>Valor Cheio</option><option>Parcelado</option><option>Êxito</option></select></div>
                                 <div><label className="text-[10px] font-bold text-slate-400">Status</label><select className="w-full p-2 border rounded text-sm" value={formData.statusPagamento} onChange={e=>setFormData({...formData, statusPagamento: e.target.value})}><option>Pendente</option><option>Pago</option></select></div>
                             </div>
                             {formData.tipoPagamento === 'Parcelado' ? (
                                <div className="grid grid-cols-2 gap-3">
                                    <div><label className="text-[10px] font-bold text-slate-400">Qtd</label><input type="number" className="w-full p-2 border rounded text-sm" value={formData.qtdParcelas} onChange={e=>setFormData({...formData, qtdParcelas: e.target.value})}/></div>
                                    <div><label className="text-[10px] font-bold text-slate-400">Valor Parc.</label><input className="w-full p-2 border rounded text-sm" placeholder="R$" value={formData.valorParcela} onChange={e=>setFormData({...formData, valorParcela: e.target.value})}/></div>
                                </div>
                             ) : (
                                <div><label className="text-[10px] font-bold text-slate-400">Valor Total</label><input className="w-full p-2 border rounded text-sm font-bold" placeholder="R$ 0,00" value={formData.valorContrato} onChange={e=>setFormData({...formData, valorContrato: e.target.value})}/></div>
                             )}
                        </div>
                    </div>

                    <div className="p-4 bg-slate-50 border-t flex gap-3 shrink-0">
                        <button onClick={()=>setModal(false)} className="flex-1 py-3 rounded-lg border text-slate-500 font-bold hover:bg-slate-100 transition">CANCELAR</button>
                        <button onClick={salvar} className="flex-[2] py-3 rounded-lg bg-navy text-white font-bold hover:bg-slate-800 shadow transition flex items-center justify-center gap-2"><Icons.Check/> SALVAR</button>
                    </div>
                </div>
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AppContent />);
  </script>
</body>
</html>